<!-- table.html -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>社宅表格</title>
  <!-- amCharts Styles -->
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    table, th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
    }
    tr.selected {
      background-color: #d0ebff !important;
    }
    a {
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  
  <table border="1">
    <thead>
        <tr>
          <th>社宅</th>
          <th>總戶數</th>
          <th>一般戶</th>
          <th>一般戶具政策資格</th>
          <th>警消戶</th>
          <th>政策戶</th>
          <th>安置戶</th>
          <th>拆遷戶/中繼戶</th>
          <th>高齡友善換居</th>
          <th>專案戶</th>
        </tr>
    </thead>
    <tbody id="housingTable">
        <tr data-name="中路一號" data-values='[{"category":"一般戶", "value":75},{"category":"警消戶", "value":4},{"category":"政策戶", "value":72},{"category":"拆遷戶", "value":15},{"category":"專案戶", "value":6}]'>
          <td><a href="#" onclick="sendData(this)">中路一號</a></td><td>166/169</td><td>75</td><td>0</td><td><a href="https://birg15.axshare.com/#id=5jymcj&p=%E4%B8%80%E8%88%AC%E6%88%B6" target="_blank">4</a></td><td>72</td><td>0</td><td>15</td><td>0</td><td>6</td>
        </tr>
        <tr data-name="中路二號" data-values='[{"category":"一般戶", "value":104},{"category":"警消戶", "value":0},{"category":"政策戶", "value":104},{"category":"高齡友善換居", "value":1}]'>
          <td><a href="#" onclick="sendData(this)">中路二號</a></td><td>210/212</td><td>104</td><td>1</td><td>0</td><td>104</td><td>0</td><td>0</td><td>1</td><td>0</td>
        </tr>
        <tr data-name="中路三號" data-values='[{"category":"一般戶", "value":212},{"category":"警消戶", "value":4},{"category":"政策戶", "value":187},{"category":"安置戶", "value":3},{"category":"高齡友善換居", "value":1}]'>
          <td><a href="#" onclick="sendData(this)">中路三號</a></td><td>413/417</td><td>212</td><td>6</td><td>4</td><td>187</td><td>3</td><td>0</td><td>1</td><td>0</td>
        </tr>
        <tr data-name="中路四號" data-values='[{"category":"一般戶", "value":166},{"category":"警消戶", "value":2},{"category":"政策戶", "value":144},{"category":"高齡友善換居", "value":3},{"category":"專案戶", "value":26}]'>
          <td><a href="#" onclick="sendData(this)">中路四號</a></td><td>343/350</td><td>166</td><td>2</td><td>2</td><td>144</td><td>0</td><td>0</td><td>3</td><td>26</td>
        </tr>
        <tr data-name="蘆竹一號" data-values='[{"category":"一般戶", "value":60},{"category":"政策戶", "value":51},{"category":"專案戶", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">蘆竹一號</a></td><td>114/114</td><td>60</td><td>1</td><td>0</td><td>51</td><td>0</td><td>0</td><td>0</td><td>2</td>
        </tr>
        <tr data-name="蘆竹二號" data-values='[{"category":"一般戶", "value":178},{"category":"警消戶", "value":5},{"category":"政策戶", "value":115},{"category":"拆遷戶", "value":94}]'>
          <td><a href="#" onclick="sendData(this)">蘆竹二號</a></td><td>406/416</td><td>178</td><td>14</td><td>5</td><td>115</td><td>0</td><td>94</td><td>0</td><td>0</td>
        </tr>
        <tr data-name="八德一號" data-values='[{"category":"一般戶", "value":196},{"category":"警消戶", "value":5},{"category":"政策戶", "value":209},{"category":"安置戶", "value":1}]'>
          <td><a href="#" onclick="sendData(this)">八德一號</a></td><td>406/418</td><td>196</td><td>1</td><td>5</td><td>209</td><td>1</td><td>0</td><td>0</td><td>0</td>
        </tr>
        <tr data-name="八德二號" data-values='[{"category":"一般戶", "value":156},{"category":"警消戶", "value":4},{"category":"政策戶", "value":172},{"category":"專案戶", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">八德二號</a></td><td>335/354</td><td>156</td><td>1</td><td>4</td><td>172</td><td>0</td><td>0</td><td>0</td><td>2</td>
        </tr>
        <tr data-name="中壢一號" data-values='[{"category":"一般戶", "value":272},{"category":"警消戶", "value":8},{"category":"政策戶", "value":228},{"category":"安置戶", "value":2},{"category":"高齡友善換居", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">中壢一號</a></td><td>520/524</td><td>272</td><td>8</td><td>8</td><td>228</td><td>2</td><td>0</td><td>2</td><td>0</td>
        </tr>
        <tr data-name="中壢二號" data-values='[{"category":"一般戶", "value":489},{"category":"警消戶", "value":2},{"category":"政策戶", "value":428},{"category":"高齡友善換居", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">中壢二號</a></td><td>933/957</td><td>489</td><td>12</td><td>2</td><td>428</td><td>0</td><td>0</td><td>2</td><td>0</td>
        </tr>
        <tr data-name="平鎮一號" data-values='[{"category":"一般戶", "value":31},{"category":"警消戶", "value":1},{"category":"政策戶", "value":28},{"category":"專案戶", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">平鎮一號</a></td><td>64/64</td><td>31</td><td>2</td><td>1</td><td>28</td><td>0</td><td>0</td><td>0</td><td>2</td>
        </tr>
        <tr data-name="楊梅一號" data-values='[{"category":"一般戶", "value":115},{"category":"警消戶", "value":2},{"category":"政策戶", "value":90},{"category":"高齡友善換居", "value":2}]'>
          <td><a href="#" onclick="sendData(this)">楊梅一號</a></td><td>215/216</td><td>115</td><td>6</td><td>2</td><td>90</td><td>0</td><td>0</td><td>2</td><td>0</td>
        </tr>
        <tr data-name="東門段(都更)" data-values='[{"category":"一般戶", "value":23},{"category":"政策戶", "value":45}]'>
          <td><a href="#" onclick="sendData(this)">東門段(都更)</a></td><td>69/70</td><td>23</td><td>1</td><td>0</td><td>45</td><td>0</td><td>0</td><td>0</td><td>0</td>
        </tr>
        <tr data-name="中興巷(都更)" data-values='[{"category":"一般戶", "value":31},{"category":"政策戶", "value":52}]'>
          <td><a href="#" onclick="sendData(this)">中興巷(都更)</a></td><td>89/93</td><td>31</td><td>0</td><td>0</td><td>52</td><td>0</td><td>0</td><td>0</td><td>0</td>
        </tr>
    </tbody>
  </table>

  <script>
    window.addEventListener('message', function (e) {
      if (e.data.type === 'selectHousing') {
        const name = e.data.name;
        const rows = document.querySelectorAll('#housingTable tr');
        rows.forEach(row => {
          row.classList.remove('selected');
          if (row.dataset.name === name) {
            row.classList.add('selected');
            const link = row.querySelector('a');
            if (link) link.click();
          }
        });
      }
    });

    function sendData(el) {
      const tr = el.closest("tr");
      const name = tr.dataset.name;
      const values = JSON.parse(tr.dataset.values);
      window.parent.frames['chartFrame'].postMessage({ name, values }, "*");
          const rows = document.querySelectorAll('#housingTable tr');
          rows.forEach(row => {
          row.classList.remove('selected');
          if (row.dataset.name === name) {
            row.classList.add('selected');
            const link = row.querySelector('a');
            if (link){
              link.on('click', function (params) {
                const name = params.name;
                window.parent.postMessage({ type: 'goToBarNew' }, '*');
              });                
            }
          }
        });

    }

  </script>
</body>
</html>